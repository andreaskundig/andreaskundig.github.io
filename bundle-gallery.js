!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(module,exports,__webpack_require__){var ajax=__webpack_require__(5),urlUtils=__webpack_require__(4),gifshot=__webpack_require__(3),io={convertToJsonp:function(e){return"load("+JSON.stringify(e)+");"}};io.files={installUploader:function(uploadLink,load){var loader=document.createElement("input");loader.type="file",loader.style.display="none";var handleJson=function(uploadEvent){var reader=new FileReader;reader.onload=function(readerEvent){var b64content=readerEvent.target.result,b64="base64,",b64index=b64content.indexOf(b64)+b64.length;b64content.substr(b64index);var content=atob(b64content.substr(b64index));eval(content)},reader.readAsDataURL(uploadEvent.target.files[0])};loader.addEventListener("change",handleJson,!1),uploadLink.addEventListener("click",loader.click.bind(loader),!1)},dataAsUri:function(e){var t=io.convertToJsonp(e);return"data:application/javascript;base64,"+btoa(t)},installDownloader:function(e,t){e.setAttribute("download","bouboucle.jsonp");var n=function(){e.href=this.dataAsUri(t())}.bind(this);e.addEventListener("click",n,!1)}},io.server={save:function(e,t){var n=io.convertToJsonp(e()),r="/animations/"+(t||Date.now()+".js"),i=encodeURIComponent(n);return ajax.HTTPrequest(r,"POST",{"Content-Type":"application/javascript"},i)},loadDirAsJson:function(e){return ajax.HTTPrequest("/animations/"+e,"GET").catch(console.error.bind(console))},loadDirAnimationList:function(e){return ajax.HTTPrequest("/animations/"+e+"/"+e+".json","GET").then(JSON.parse).catch(console.error.bind(console))},load:function(e,t){return new Promise(function(n,r){var i=document.getElementById("the-animation");i&&i.parentNode.removeChild(i),window.load=function(){t.apply(this,arguments),n(0)};var o=document.createElement("script");o.setAttribute("src",e),o.setAttribute("id","the-animation"),o.addEventListener("error",function(){r("Error loading script.")}),o.addEventListener("abort",function(){r("Script loading aborted.")}),document.head.appendChild(o),n(e)})}},io.gists={save:function(e){if(0==e().lineData.length)return Promise.resolve(0);var t={description:"stroke looper animation",public:!0,files:{"looper.jsonp":{content:io.convertToJsonp(e())}}},n={"Content-Type":"application/json"};return n[atob("bm9pdGF6aXJvaHR1QQ==").split("").reverse().join("")]=atob("MVUyWW1KalpqQnpOMkkyWXlRVE4zQVRPNEVETTNjVFlraFRZaUZ6TmlabVpoVldaMFF6TXpvelpwUm1iMXQyY2hWbWNrNVdZIGNpc2FC").split("").reverse().join(""),ajax.HTTPrequest("https://api.github.com/gists","POST",n,JSON.stringify(t)).then(JSON.parse).then(function(e){var r=e.id;e.files["looper.jsonp"]&&(r=e.files["looper.jsonp"].raw_url.match(/[^/]+\/raw\/[^/]+/)[0]);var i="http://bouboucle.com?gist="+r;return t.files["description.md"]={content:i},ajax.HTTPrequest("https://api.github.com/gists/"+e.id,"PATCH",n,JSON.stringify(t)),console.log(e),urlUtils.addUrlParams({gist:r}),r})},installSaver:function(e,t){var n=function(){this.save(t)}.bind(this);e.addEventListener("click",n,!1)},makeGistUrl:function(e){return"https://api.github.com/gists/"+e},makeRawGistUrl:function(e){return"https://gist.githubusercontent.com/andreaskundig/"+e+"/looper.jsonp"},loadContent:function(e){if(e.includes("raw")){var t=this.makeRawGistUrl(e);return console.log(t),ajax.HTTPrequest(t,"GET")}var n=this.makeGistUrl(e);return ajax.HTTPrequest(n,"GET").then(JSON.parse).then(function(e){if(!(e.files&&"looper.jsonp"in e.files))throw"no files found";return console.log("load gist "+e.html_url),e.files["looper.jsonp"].content})},load:function(id,load){return this.loadContent(id).then(function(content){eval(content),urlUtils.addUrlParams({gist:id})}).catch(console.error.bind(console))},installLoader:function(e,t){var n=function(){var e=prompt("gist to load").trim();e&&(e=urlUtils.getUrlParam(e,"gist")||e,console.log("got param gist ",e),this.load(e,t))}.bind(this);e.addEventListener("click",n,!1)}},io.makeGifRecorder=function(e){var t=0,n=[];return{recordImage:function(){n.push(e.toDataURL("image/png")),t+=n[n.length-1].length},makeGif:function(r,i,o){var a=n.slice(),s=e.width,c=e.width/200/15*t/5e6,u=Math.max(1,c/1),l=Math.min(1,1/Math.sqrt(u));l=o?1:l,n.length=0,s=Math.floor(s*l);var d=Math.floor(s*e.height/e.width);return n.length=0,t=0,new Promise(function(e,t){gifshot.createGIF({interval:r/1e3,images:a,gifWidth:s,gifHeight:d,progressCallback:i},function(n){n.error?(t(n),console.log("gifshot error:",n)):e(n.image)})})}}},module.exports=io},function(e,t,n){var r=n(0),i={animatou2017:["1507301371007","1507327736449","1507383726780","1507455201651","1507303866454","1507327751666","1507383935596","1507455315523","1507305824698","1507328173093","1507390892142","1507458463828","1507305933937","1507329932221","1507391042273","1507462965913","1507306324518","1507329951816","1507391186167","1507463922577","1507306369657","1507330180144","1507391375405","1507466152673","1507306380981","1507330317159","1507394806008","1507467865287","1507306689950","1507330408284","1507397851002","1507468065164","1507306990061","1507330460867","1507398554430","1507470610316","1507307477420","1507330663768","1507399927011","1507470779407","1507307580225","1507330670942","1507401773067","1507471203790","1507307637157","1507331154625","1507404681643","1507477458817","1507307744038","1507331570060","1507405019174","1507477851139","1507307977010","1507332249009","1507405199808","1507477881463","1507308209304","1507332339222","1507405514120","1507477904910","1507316056667","1507332992282","1507406655159","1507477918309","1507317343140","1507362806520","1507406845283","1507480839974","1507318286195","1507362854129","1507406915839","1507481561270","1507318392511","1507364521486","1507406961397","1507481570237","1507318623350","1507364642849","1507407038829","1507484370546","1507318957893","1507369689055","1507407354840","1507484487258","1507319237046","1507369700138","1507407611060","1507485307613","1507319274858","1507369834670","1507407704969","1507485378972","1507319474826","1507370734603","1507408608147","1507485495841","1507319547447","1507371162794","1507408623776","1507485668814","1507319641264","1507371673061","1507417019712","1507558964013","1507319928058","1507373471378","1507419115738","1507559455752","1507319954461","1507376314264","1507419770784","1507559780794","1507319979872","1507376576132","1507420066170","1507565616070","1507320019873","1507377192702","1507420085024","1507570095460","1507320132131","1507379095511","1507420098700","1507643354478","1507320433506","1507379230176","1507447243271","1507647650413","1507320911833","1507379368134","1507448298121","1507653181270","1507322696384","1507379935691","1507450293128","1507738113880","1507322805628","1507380055126","1507455022363","1507742019896","1507327627246","1507383125083","1507455077998"],fumetto2017:["1490878588367","1490888244937","1491045846385","1491046983706","1491047906677","1491048334932","1491052703079","1491052768481","1491053284911","1491053681057","1491057248256","1491126182039","1491126234607","1491126281724","1491126296395","1491126313768","1491126331268","1491126362729","1491126383532","1491126952833","1491127005171","1491127077877","1491127201956","1491129050665","1491129074474","1491131767318","1491131781609","1491131802147","1491131880875","1491132996989","1491133269096","1491133516186","1491133602746","1491134102930","1491134168991","1491134982127","1491135072947","1491136181209","1491142352279","1491142456074","1491146703990","1491151685094","1491151919812","1491214888659","1491214917379","1491221675101","1491231940693","1491232404208","1491232520730","1491232554588","1491236665290","1491236885250","1491237148954","1491303384475","1491307975499","1491308366967","1491308481019","1491308594263","1491309251773","1491309801473","1491311190161","1491317198761","1491317781671","1491317964113","1491320657503","1491320749648","1491320861921","1491321271469","1491382250273","1491382279272","1491382412959","1491386560497","1491386636711","1491386759004","1491401198467","1491401623060","1491403731655","1491406105619","1491406114346","1491406165023","1491410410614","1491410455619","1491410506252","1491570757956","1491570829461","1491576508179","1491576689310","1491579177256","1491587912348","1491588128660","1491588379221","1491588955803","1491589382856","1491591013593","1491591444398","1491591838997","1491592566701","1491593107092","1491597013427","1491597386260","1491656615640","1491656711879","1491656944053","1491657587773","1491658168574","1491658269666"],exemples:["Autoportrait_Sandra_Verine","Bouboucle_Ivan_Gulizia","Carre_Andreas_Kundig","Comme_du_vent_souffle_sur_des_pluies_acides_Yannis_La_Macchia","Ebloui_Andreas_Kundig","Encore_un_visage_Ivan_Gulizia","Grouille_Andreas_Kundig","Ideogrammes_1_Andreas_Kundig","La_Matrice_Holistique_Ivan_Gulizia","Pluie3_Andreas_Kundig","Procession_Andreas_Kundig","Retombe_Andreas_Kundig","Sans_Titre_2_Tanx","Sans_Titre_2_Valerie_Kosik","Sans_Titre_Baladi","Sans_Titre_Barbara_Meuli","Sans_Titre_Guillaume_Heurtault","Sans_Titre_June","Sans_Titre_Popier_Popol_II","Sans_Titre_Tanx","Sans_Titre_Valerie_Kosik","Visage_Andreas_Kundig","Zap_Yannis_La_Macchia"]},o=[["è","e"],["é","e"],["ê","e"],["ë","e"],["ü","u"],[" ","-"],["à","a"],[",","-"],["\\.","-"],["'","-"],["/","-"],["\\(",""],["\\)",""],["\\?",""]],a=function(e){return t=e.author+"__"+e.title,o.reduce(function(e,t){return e.replace(new RegExp(t[0],"g"),t[1])},t)+".js";var t};e.exports.getCollections=function(e){return i[e]?Promise.resolve(i[e].map(function(e){return{name:e,id:e}})):r.server.loadDirAnimationList(e).then(function(e){return e.forEach(function(e){let t=a(e);t=t.substr(0,t.length-".js".length),e.name=t,e.id=e.gist}),e})},e.exports.makeAnimationFileName=a},function(e,t,n){var r=n(0),i=n(1);e.exports=function(e,t){var n=e.importData,o=function(e){var t,n=document.getElementById("animation-name");e.title?(t=`<span class="title">${e.fullTitle||e.title}</span>`,t+=` ${e.author}`):t=e.name.split("/")[t.length-1].split(".")[0],n?(n.innerHTML=t,console.log(n.innerHTML)):console.error('element "div#animation-name" does not exist')},a=function(t){(t||t("save"))&&r.gists.save(e.exportData).then(function(e){console.log(e),e&&window.open("http://bouboucle.com/?gist="+e,"_blank")},function(e){console.log(e)})},s=function(e,t,n,r){return e=e||0,r&&(e+=isNaN(t)?1:t,e=(Math.ceil(Math.abs(e/r))*r+e)%r),localStorage.setItem(n,e),e},c=function(e){var t=[],i=e.name,c=i+"Index",u=parseInt(localStorage.getItem(c)||"-1",10),l=function(){return r.server.loadDirAsJson(i).then(JSON.parse).then(e=>e.filter(function(e){return e.endsWith(".js")||e.endsWith(".jsonp")}).map(function(e){return{name:e}}))},d=function(e){return l().then(function(a){if(0==a.length)throw"no animations";var s=!1;for(0==t.length&&(t=a);t.length<a.length;)s=a[t.length],t.push(s);e&&function(e){if(e){var n=t.findIndex(function(t){return t.name==e.name});null!=n&&(u=n)}}(e),!e&&s||(s=t[u]);var c="/animations/"+i+"/"+s.name;return r.server.load(c,n).then(function(t){o(e)})})};return l().then(function(e){t=e}),{next:function(e){return this.increment(e),d()},increment:function(e){u=s(u,e,c,t.length)},load:d,getList:l,getLength:e=>t.length,save:a}},u=function(e,t){var n,r=t&&t.period||5e3,i=t&&"pause"in t?t.pause:2e4,o=!0,a=e.next,s=e.load,c=function(e,t){n=setTimeout(e,t)},u=async function(e){clearTimeout(n);var t=await a(e)||r;o&&void 0===e?c(u,t):d()},l=function(){o=!0,u()},d=function(){o=!1,clearTimeout(n),i&&c(l,i)},f={start:l,stop:d,togglePlay:function(){return o?d():l(),o},load:function(e){return d(),s(e)},next:u};return Object.assign(e,f)},l={constructors:{alternating:function(e){var t=[],n=e.loaders.map(function(e){return d(e)});return{next:async function(e){try{if(e<0&&t.length>1){var r=t.pop(),i=n[r],o=t[t.length-1],a=n[o];return i.increment(e),a.load()}var s=n.map(e=>e.getLength()),c=s.reduce((e,t)=>e+t,0),u=s.reduce((e,t)=>{var n=0==c?1:t/c;return n+=e.length?e[e.length-1]:0,e.push(n),e},[]),l=Math.random(),d=u.findIndex(e=>e>l),f=n[d],h=n[(d+1)%n.length];m=d,(g=localStorage.getItem("loaderHistory"))&&(t=JSON.parse(g)),t.push(m),t.length>10&&t.unshift(),localStorage.setItem("loaderHistory",JSON.stringify(t)),f.next(e).catch(function(e){return console.error(e),h.next(1)})}catch(e){console.error(e)}var m,g;return null},load:function(e){var r=n[e.loaderIndex];return r&&r.load?(t=[],localStorage.setItem("loaderHistory",JSON.stringify([])),r.load(e)):0},save:a,getList:function(){return Promise.all(n.map(function(e,t){return{loaderIndex:t,getList:e.getList}}).filter(function(e){return e.getList}).map(function(e){return e.getList().then(function(t){return t.forEach(function(t){t.loaderIndex=e.loaderIndex}),t})})).then(function(e){return e.reduce(function(e,t){return e.concat(t)},[])})}}},list:function(e){var t,a=e.name,c=a+"Index",u=parseInt(localStorage.getItem(c)||"-1",10),l=function(){return t?t.length:0},d=function(e){u=s(u,e,c,l())},f=function(){return t?Promise.resolve(t):i.getCollections(a).then(function(e){return t=e})},h=function(e){if(e){var n=t.findIndex(function(t){return t.id==e.id});null!=n&&(u=n)}return u},m=function(e){return f().then(function(t){h(e);var i=t[u];return i?r.server.load("animations/"+a+"/"+i.name+".js",n).then(function(e){o(i)}):(console.log("hey"),Promise.resolve())})};return f(),{next:function(e){return d(e),m()},increment:d,load:m,getList:f,getLength:l}},directory:c,autosave:function(){return{next:function(e){return r.server.loadDirAsJson("auto").then(JSON.parse).then(function(e){var t=Date.now(),i=e.reduce((e,n)=>{if(!n.endsWith(".js")&&!n.endsWith(".jsonp"))return e;var[r,i]=n.split(/-|\./);return t-parseInt(i,10)>1e4?e:((!e[r]||e[r]<n)&&(e[r]=n),e)},{}),a=Object.keys(i).map(e=>i[e]),s=a[Math.floor(Math.random()*a.length)];return s?(console.log("load",s),r.server.load("/animations/auto/"+s,n).then(function(e){o({name:s})}),2e3):0}).catch(e=>console.error(e))},save:a}}},decorators:{highPriority:function(e,t){return t.highPriority,Object.assign({},e,{next:async function(t){return await e.next(t)}})},reloadPage:function(e,t){var n=t.count,r=0,i=e.next;return Object.assign(e,{next:async function(e){return r>=n&&location.reload(),r++,await i(e)}})},autoPlay:u}},d=function(e,t){if(Array.isArray(e))return e.reduce(function(e,t){return d(t,e)},null);if(e.constr)return(0,l.constructors[e.constr])(e);if(e.decorator)return(0,l.decorators[e.decorator])(t,e);throw"unknown type: "+e};return t?d(t.loaders):u(c({name:"saved"}))}},function(e,t,n){var r;!function(n,i,o,a){"use strict";var s,c,u={URL:n.URL||n.webkitURL||n.mozURL||n.msURL,getUserMedia:(c=o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia,c?c.bind(o):c),requestAnimFrame:n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame,requestTimeout:function(e,t){if(e=e||u.noop,t=t||0,!u.requestAnimFrame)return setTimeout(e,t);var n=(new Date).getTime(),r=new Object,i=u.requestAnimFrame;return r.value=i(function o(){(new Date).getTime()-n>=t?e.call():r.value=i(o)}),r},Blob:n.Blob||n.BlobBuilder||n.WebKitBlobBuilder||n.MozBlobBuilder||n.MSBlobBuilder,btoa:(s=n.btoa||function(e){for(var t="",n=0,r=e.length,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0,d=void 0;n<r;)c=(o=e.charCodeAt(n++))>>2,u=(3&o)<<4|(a=e.charCodeAt(n++))>>4,l=(15&a)<<2|(s=e.charCodeAt(n++))>>6,d=63&s,isNaN(a)?l=d=64:isNaN(s)&&(d=64),t=t+i.charAt(c)+i.charAt(u)+i.charAt(l)+i.charAt(d);return t},s?s.bind(n):u.noop),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return u.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=i.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:function(){return n.Worker},blob:function(){return u.Blob},Uint8Array:function(){return n.Uint8Array},Uint32Array:function(){return n.Uint32Array},videoCodecs:function(){var e=i.createElement("video"),t={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(t.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),t.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),t.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),t.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),t.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(e){}return t}()},noop:function(){},each:function(e,t){var n=void 0,r=void 0;if(u.isArray(e))for(n=-1,r=e.length;++n<r&&!1!==t(n,e[n]););else if(u.isObject(e))for(n in e)if(e.hasOwnProperty(n)&&!1===t(n,e[n]))break},mergeOptions:function(e,t){if(u.isObject(e)&&u.isObject(t)&&Object.keys){var n={};return u.each(e,function(t,r){n[t]=e[t]}),u.each(t,function(r,i){var o=t[r];u.isObject(o)&&e[r]?n[r]=u.mergeOptions(e[r],o):n[r]=o}),n}},setCSSAttr:function(e,t,n){u.isElement(e)&&(u.isString(t)&&u.isString(n)?e.style[t]=n:u.isObject(t)&&u.each(t,function(t,n){e.style[t]=n}))},removeElement:function(e){u.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!u.isString(e))return{};try{var t=new u.Blob([e],{type:"text/javascript"}),n=u.URL.createObjectURL(t);return{objectUrl:n,worker:new Worker(n)}}catch(e){return""+e}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{};if(!i.body||!1===e.resizeFont)return e.fontSize;var t=e.text,n=e.gifWidth,r=parseInt(e.fontSize,10),o=parseInt(e.minFontSize,10),s=i.createElement("div"),c=i.createElement("span");for(s.setAttribute("width",n),s.appendChild(c),c.innerHTML=t,c.style.fontSize=r+"px",c.style.textIndent="-9999px",c.style.visibility="hidden",i.body.appendChild(c);c.offsetWidth>n&&r>=o;)c.style.fontSize=--r+"px";return i.body.removeChild(c),r+"px"},webWorkerError:!1},l=Object.freeze({default:u}),d={validate:function(e){e=u.isObject(e)?e:{};var t={};return u.each(d.validators,function(n,r){var i=r.errorCode;if(!e[i]&&!r.condition)return(t=r).error=!0,!1}),delete t.condition,t},isValid:function(e){var t=!0!==d.validate(e).error;return t},validators:[{condition:u.isFunction(u.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:u.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:u.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:u.isFunction(u.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:u.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:u.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:u.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},f=Object.freeze({default:d}),h=function(){},m={sampleInterval:10,numWorkers:2,filter:"",gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:h,completeCallback:h,saveRenderingContexts:!1,savedRenderingContexts:[],crossOrigin:"Anonymous"},g=Object.freeze({default:m});function p(){return d.isValid()}function v(){var e,t,n,r,i,o=256,a=499,s=491,c=487,u=503,l=3*u,d=o-1,f=4,h=100,m=16,g=1<<m,p=10,v=10,b=g>>v,w=g<<p-v,y=6,x=(o>>3)*(1<<y),S=30,k=1024,C=256,E=1<<18,T=[],M=[],_=[],L=[];function O(e,t,n,r,a){var s,c,u,l,d,f,h;for((u=t-e)<-1&&(u=-1),(l=t+e)>o&&(l=o),s=t+1,c=t-1,f=1;s<l||c>u;){if(d=L[f++],s<l){h=i[s++];try{h[0]-=d*(h[0]-n)/E|0,h[1]-=d*(h[1]-r)/E|0,h[2]-=d*(h[2]-a)/E|0}catch(e){}}if(c>u){h=i[c--];try{h[0]-=d*(h[0]-n)/E|0,h[1]-=d*(h[1]-r)/E|0,h[2]-=d*(h[2]-a)/E|0}catch(e){}}}}function P(e,t,n,r,o){var a=i[t],s=e/k;a[0]-=s*(a[0]-n)|0,a[1]-=s*(a[1]-r)|0,a[2]-=s*(a[2]-o)|0}function I(e,t,n){var r,a,s,c,u,l,d,h,g,y;for(g=h=~(1<<31),d=l=-1,r=0;r<o;r++)(a=(y=i[r])[0]-e)<0&&(a=-a),(s=y[1]-t)<0&&(s=-s),a+=s,(s=y[2]-n)<0&&(s=-s),(a+=s)<h&&(h=a,l=r),(c=a-(M[r]>>m-f))<g&&(g=c,d=r),u=_[r]>>v,_[r]-=u,M[r]+=u<<p;return _[l]+=b,M[l]-=w,d}(function(e,a,s){var c,u;for(t=e,n=a,r=s,i=new Array(o),c=0;c<o;c++)i[c]=new Array(4),(u=i[c])[0]=u[1]=u[2]=(c<<f+8)/o|0,_[c]=g/o|0,M[c]=0}).apply(this,arguments);var F={map:function(e,t,n){var r,a,s,c,u,l,d;for(u=1e3,d=-1,a=(r=T[t])-1;r<o||a>=0;)r<o&&((s=(l=i[r])[1]-t)>=u?r=o:(r++,s<0&&(s=-s),(c=l[0]-e)<0&&(c=-c),(s+=c)<u&&((c=l[2]-n)<0&&(c=-c),(s+=c)<u&&(u=s,d=l[3])))),a>=0&&((s=t-(l=i[a])[1])>=u?a=-1:(a--,s<0&&(s=-s),(c=l[0]-e)<0&&(c=-c),(s+=c)<u&&((c=l[2]-n)<0&&(c=-c),(s+=c)<u&&(u=s,d=l[3]))));return d}};return F.process=function(){return function(){var i,o,d,m,g,p,v,b,w,E,T,M,_,F;for(n<l&&(r=1),e=30+(r-1)/3,M=t,_=0,F=n,E=(T=n/(3*r))/h|0,b=k,(v=(p=x)>>y)<=1&&(v=0),i=0;i<v;i++)L[i]=b*((v*v-i*i)*C/(v*v));for(w=n<l?3:n%a!=0?3*a:n%s!=0?3*s:n%c!=0?3*c:3*u,i=0;i<T;)if(P(b,o=I(d=(255&M[_+0])<<f,m=(255&M[_+1])<<f,g=(255&M[_+2])<<f),d,m,g),0!==v&&O(v,o,d,m,g),(_+=w)>=F&&(_-=n),i++,0===E&&(E=1),i%E==0)for(b-=b/e,(v=(p-=p/S)>>y)<=1&&(v=0),o=0;o<v;o++)L[o]=b*((v*v-o*o)*C/(v*v))}(),function(){var e;for(e=0;e<o;e++)i[e][0]>>=f,i[e][1]>>=f,i[e][2]>>=f,i[e][3]=e}(),function(){var e,t,n,r,a,s,c,u;for(c=0,u=0,e=0;e<o;e++){for(n=e,r=(a=i[e])[1],t=e+1;t<o;t++)(s=i[t])[1]<r&&(n=t,r=s[1]);if(s=i[n],e!=n&&(t=s[0],s[0]=a[0],a[0]=t,t=s[1],s[1]=a[1],a[1]=t,t=s[2],s[2]=a[2],a[2]=t,t=s[3],s[3]=a[3],a[3]=t),r!=c){for(T[c]=u+e>>1,t=c+1;t<r;t++)T[t]=e;c=r,u=e}}for(T[c]=u+d>>1,t=c+1;t<256;t++)T[t]=d}(),function(){for(var e=[],t=new Array(o),n=0;n<o;n++)t[i[n][3]]=n;for(var r=0,a=0;a<o;a++){var s=t[a];e[r++]=i[s][0],e[r++]=i[s][1],e[r++]=i[s][2]}return e}()},F}function b(){try{this.onmessage=function(t){var n,r=t.data||{};r.gifshot&&(n=e.run(r),postMessage(n))}}catch(e){}var e={dataToRGB:function(e,t,n){for(var r=t*n*4,i=0,o=[];i<r;)o.push(e[i++]),o.push(e[i++]),o.push(e[i++]),i++;return o},componentizedPaletteToArray:function(e){e=e||[];for(var t=[],n=0;n<e.length;n+=3){var r=e[n],i=e[n+1],o=e[n+2];t.push(r<<16|i<<8|o)}return t},processFrameWithQuantizer:function(e,t,n,r){for(var i=this.dataToRGB(e,t,n),o=new v(i,i.length,r),a=o.process(),s=new Uint32Array(this.componentizedPaletteToArray(a)),c=t*n,u=new Uint8Array(c),l=0,d=0;d<c;d++){var f=i[l++],h=i[l++],m=i[l++];u[d]=o.map(f,h,m)}return{pixels:u,palette:s}},run:function(e){var t=e=e||{},n=t.height,r=(t.palette,t.sampleInterval),i=t.width,o=e.data;return this.processFrameWithQuantizer(o,i,n,r)}};return e}function w(e,t,n,r){var i=0,o=(r=r===a?{}:r).loop===a?null:r.loop,s=r.palette===a?null:r.palette;if(t<=0||n<=0||t>65535||n>65535)throw"Width/Height invalid.";e[i++]=71,e[i++]=73,e[i++]=70,e[i++]=56,e[i++]=57,e[i++]=97;if(e[i++]=255&t,e[i++]=t>>8&255,e[i++]=255&n,e[i++]=n>>8&255,e[i++]=0|(null!==s?128:0),e[i++]=0,e[i++]=0,null!==o){if(o<0||o>65535)throw"Loop count invalid.";e[i++]=33,e[i++]=255,e[i++]=11,e[i++]=78,e[i++]=69,e[i++]=84,e[i++]=83,e[i++]=67,e[i++]=65,e[i++]=80,e[i++]=69,e[i++]=50,e[i++]=46,e[i++]=48,e[i++]=3,e[i++]=1,e[i++]=255&o,e[i++]=o>>8&255,e[i++]=0}var c=!1;this.addFrame=function(t,n,r,o,u,l){if(!0===c&&(--i,c=!1),l=l===a?{}:l,t<0||n<0||t>65535||n>65535)throw"x/y invalid.";if(r<=0||o<=0||r>65535||o>65535)throw"Width/Height invalid.";if(u.length<r*o)throw"Not enough pixels for the frame size.";var d=!0,f=l.palette;if(f!==a&&null!==f||(d=!1,f=s),f===a||null===f)throw"Must supply either a local or global palette.";for(var h=function(e){var t=e.length;if(t<2||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}(f),m=0;h>>=1;)++m;h=1<<m;var g=l.delay===a?0:l.delay,p=l.disposal===a?0:l.disposal;if(p<0||p>3)throw"Disposal out of range.";var v=!1,b=0;if(l.transparent!==a&&null!==l.transparent&&(v=!0,(b=l.transparent)<0||b>=h))throw"Transparent color index.";if((0!==p||v||0!==g)&&(e[i++]=33,e[i++]=249,e[i++]=4,e[i++]=p<<2|(!0===v?1:0),e[i++]=255&g,e[i++]=g>>8&255,e[i++]=b,e[i++]=0),e[i++]=44,e[i++]=255&t,e[i++]=t>>8&255,e[i++]=255&n,e[i++]=n>>8&255,e[i++]=255&r,e[i++]=r>>8&255,e[i++]=255&o,e[i++]=o>>8&255,e[i++]=!0===d?128|m-1:0,!0===d)for(var w=0,y=f.length;w<y;++w){var x=f[w];e[i++]=x>>16&255,e[i++]=x>>8&255,e[i++]=255&x}i=function(e,t,n,r){e[t++]=n;var i=t++,o=1<<n,s=o-1,c=o+1,u=c+1,l=n+1,d=0,f=0;function h(n){for(;d>=n;)e[t++]=255&f,f>>=8,d-=8,t===i+256&&(e[i]=255,i=t++)}function m(e){f|=e<<d,d+=l,h(8)}var g=r[0]&s,p={};m(o);for(var v=1,b=r.length;v<b;++v){var w=r[v]&s,y=g<<8|w,x=p[y];if(x===a){for(f|=g<<d,d+=l;d>=8;)e[t++]=255&f,f>>=8,d-=8,t===i+256&&(e[i]=255,i=t++);4096===u?(m(o),u=c+1,l=n+1,p={}):(u>=1<<l&&++l,p[y]=u++),g=w}else g=x}m(g),m(c),h(1),i+1===t?e[i]=0:(e[i]=t-i-1,e[t++]=0);return t}(e,i,m<2?2:m,u)},this.end=function(){return!1===c&&(e[i++]=59,c=!0),i}}var y=function(){},x=function(e){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=y,this.onRenderProgressCallback=y,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e,this.initializeWebWorkers(e)};x.prototype={workerMethods:b(),initializeWebWorkers:function(e){var t,n=v.toString()+"("+b.toString()+"());",r=void 0,o=void 0,a=void 0,s=-1,c="";for(t=e.numWorkers;++s<t;)r=u.createWebWorker(n),u.isObject(r)?(o=r.objectUrl,a=r.worker,this.workers.push({worker:a,objectUrl:o}),this.availableWorkers.push(a)):(c=r,u.webWorkerError=!!r);this.workerError=c,this.canvas=i.createElement("canvas"),this.canvas.width=e.gifWidth,this.canvas.height=e.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;t<256;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,n="",r=-1;++r<t;)n+=this.byteMap[e[r]];return n},onFrameFinished:function(e){var t=this,n=t.frames,r=!!(t.options.images||[]).length,i=n.every(function(e){return!e.beingProcessed&&e.done});t.numRenderedFrames++,r&&e(t.numRenderedFrames/n.length),t.onRenderProgressCallback(.75*t.numRenderedFrames/n.length),i?t.generatingGIF||t.generateGIF(n,t.onRenderCompleteCallback):u.requestTimeout(function(){t.processNextFrame()},1)},processFrame:function(e){var t=this,n=(this.options,this.options),r=n.progressCallback,i=n.sampleInterval,o=this.frames,s=void 0,c=void 0,u=function(){var e=(arguments.length>0&&arguments[0]!==a?arguments[0]:{}).data;delete s.data,s.pixels=Array.prototype.slice.call(e.pixels),s.palette=Array.prototype.slice.call(e.palette),s.done=!0,s.beingProcessed=!1,t.freeWorker(c),t.onFrameFinished(r)};(s=o[e]).beingProcessed||s.done?this.onFrameFinished():(s.sampleInterval=i,s.beingProcessed=!0,s.gifshot=!0,(c=this.getWorker())?(c.onmessage=u,c.postMessage(s)):u({data:t.workerMethods.run(s)}))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var n=this.frames[t];if(!n.done&&!n.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(e,t){var n=[],r={loop:this.repeat},i=this.options,o=i.interval,a=i.frameDuration,s=!!i.images.length,c=i.gifHeight,l=i.gifWidth,d=new w(n,l,c,r),f=this.onRenderProgressCallback,h=s?100*o:0,m=void 0;this.generatingGIF=!0,u.each(e,function(t,n){var r=n.palette;f(.75+.25*n.position*1/e.length);for(var i=0;i<a;i++)d.addFrame(0,0,l,c,n.pixels,{palette:r,delay:h})}),d.end(),f(1),this.frames=[],this.generatingGIF=!1,u.isFunction(t)&&(m=this.bufferToString(n),t("data:image/gif;base64,"+u.btoa(m)))},setRepeat:function(e){this.repeat=e},addFrame:function(e,t){t=u.isObject(t)?t:{};var n=this.ctx,r=this.options,i=r.gifWidth,o=r.gifHeight,a=u.getFontSize(t),s=t,c=s.filter,l=s.fontColor,d=s.fontFamily,f=s.fontWeight,h=(s.gifHeight,s.gifWidth,s.text),m=s.textAlign,g=s.textBaseline,p=t.textXCoordinate?t.textXCoordinate:"left"===m?1:"right"===m?i:i/2,v=t.textYCoordinate?t.textYCoordinate:"top"===g?1:"center"===g?o/2:o,b=f+" "+a+" "+d,w=void 0;try{n.filter=c,n.drawImage(e,0,0,i,o),h&&(n.font=b,n.fillStyle=l,n.textAlign=m,n.textBaseline=g,n.fillText(h,p,v)),w=n.getImageData(0,0,i,o),this.addFrameImageData(w)}catch(e){return""+e}},addFrameImageData:function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=this.frames,n=e.data;this.frames.push({data:n,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(e){var t=this;t.startRendering(function(n){t.destroyWorkers(),u.requestTimeout(function(){e(n)},0)})},destroyWorkers:function(){if(!this.workerError){var e=this.workers;u.each(e,function(e,t){var n=t.worker,r=t.objectUrl;n.terminate(),u.URL.revokeObjectURL(r)})}}};var S=function(){},k={getGIF:function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=arguments[1];t=u.isFunction(t)?t:S;var n=i.createElement("canvas"),r=void 0,o=!!e.images.length,s=e.cameraStream,c=e.crop,l=e.filter,d=e.fontColor,f=e.fontFamily,h=e.fontWeight,m=e.keepCameraOn,g=(e.numWorkers,e.progressCallback),p=e.saveRenderingContexts,v=e.savedRenderingContexts,b=e.text,w=e.textAlign,y=e.textBaseline,k=e.videoElement,C=e.videoHeight,E=e.videoWidth,T=e.webcamVideoElement,M=Number(e.gifWidth),_=Number(e.gifHeight),L=Number(e.interval),O=(Number(e.sampleInterval),o?0:1e3*L),P=[],I=v.length?v.length:e.numFrames,F=I,W=new x(e),A=u.getFontSize(e),U=e.textXCoordinate?e.textXCoordinate:"left"===w?1:"right"===w?M:M/2,j=e.textYCoordinate?e.textYCoordinate:"top"===y?1:"center"===y?_/2:_,R=h+" "+A+" "+f,D=c?Math.floor(c.scaledWidth/2):0,H=c?E-c.scaledWidth:0,V=c?Math.floor(c.scaledHeight/2):0,B=c?C-c.scaledHeight:0;I=I!==a?I:10,L=L!==a?L:.1,n.width=M,n.height=_,r=n.getContext("2d"),function e(){v.length||0!==k.currentTime?function e(){var n=F-1;function i(){var i;p&&P.push(r.getImageData(0,0,M,_)),b&&(r.font=R,r.fillStyle=d,r.textAlign=w,r.textBaseline=y,r.fillText(b,U,j)),i=r.getImageData(0,0,M,_),W.addFrameImageData(i),g((I-(F=n))/I),n>0&&u.requestTimeout(e,O),F||W.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:s,videoElement:k,webcamVideoElement:T,savedRenderingContexts:P,keepCameraOn:m})})}v.length?(r.putImageData(v[I-F],0,0),i()):function e(){try{H>E&&(H=E),B>C&&(B=C),D<0&&(D=0),V<0&&(V=0),r.filter=l,r.drawImage(k,D,V,H,B,0,0,M,_),i()}catch(t){if("NS_ERROR_NOT_AVAILABLE"!==t.name)throw t;u.requestTimeout(e,100)}}()}():u.requestTimeout(e,100)}()},getCropDimensions:function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=e.videoWidth,n=e.videoHeight,r=e.gifWidth,i=e.gifHeight,o={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>n?(o.width=Math.round(t*(i/n))-r,o.scaledWidth=Math.round(o.width*(n/i))):(o.height=Math.round(n*(r/t))-i,o.scaledHeight=Math.round(o.height*(t/r))),o}},C={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function e(t){e.attempts=e.attempts||0;var n=t.cameraStream,r=t.completedCallback,i=t.videoElement;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",C.findVideoSize),r({videoElement:i,cameraStream:n,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):e.attempts<10?(e.attempts+=1,u.requestTimeout(function(){C.findVideoSize(t)},400)):r({videoElement:i,cameraStream:n,videoWidth:C.defaultVideoDimensions.width,videoHeight:C.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){u.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=u.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,n=e.cameraStream,r=e.completedCallback,i=e.streamedCallback,o=e.videoElement;if(u.isFunction(i)&&i(),t){if(u.isString(t))o.src=t,o.innerHTML='<source src="'+t+'" type="video/'+u.getExtension(t)+'" />';else if(t instanceof Blob){try{o.src=u.URL.createObjectURL(t)}catch(e){}o.innerHTML='<source src="'+t+'" type="'+t.type+'" />'}}else if(o.mozSrcObject)o.mozSrcObject=n;else if(u.URL)try{o.srcObject=n,o.src=u.URL.createObjectURL(n)}catch(e){o.srcObject=n}o.play(),u.requestTimeout(function e(){e.count=e.count||0,!0===C.loadedData?(C.findVideoSize({videoElement:o,cameraStream:n,completedCallback:r}),C.loadedData=!1):(e.count+=1)>10?C.findVideoSize({videoElement:o,cameraStream:n,completedCallback:r}):e()},0)},startStreaming:function(e){var t=u.isFunction(e.error)?e.error:u.noop,n=u.isFunction(e.streamed)?e.streamed:u.noop,r=u.isFunction(e.completed)?e.completed:u.noop,o=e.crossOrigin,a=e.existingVideo,s=e.lastCameraStream,c=e.options,l=e.webcamVideoElement,d=u.isElement(a)?a:l||i.createElement("video");o&&(d.crossOrigin=c.crossOrigin),d.autoplay=!0,d.loop=!0,d.muted=!0,d.addEventListener("loadeddata",function(e){C.loadedData=!0,c.offset&&(d.currentTime=c.offset)}),a?C.stream({videoElement:d,existingVideo:a,completedCallback:r}):s?C.stream({videoElement:d,cameraStream:s,streamedCallback:n,completedCallback:r}):u.getUserMedia({video:!0},function(e){C.stream({videoElement:d,cameraStream:e,streamedCallback:n,completedCallback:r})},t)},startVideoStreaming:function(e){var t=arguments.length>1&&arguments[1]!==a?arguments[1]:{},n=t.timeout!==a?t.timeout:0,r=t.callback,i=t.webcamVideoElement,o=void 0;n>0&&(o=u.requestTimeout(function(){C.onStreamingTimeout(r)},1e4)),C.startStreaming({error:function(){r({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(o)},completed:function(){var t=arguments.length>0&&arguments[0]!==a?arguments[0]:{},n=t.cameraStream,r=t.videoElement,i=t.videoHeight,o=t.videoWidth;e({cameraStream:n,videoElement:r,videoHeight:i,videoWidth:o})},lastCameraStream:t.lastCameraStream,webcamVideoElement:i,crossOrigin:t.crossOrigin,options:t})},stopVideoStreaming:function(e){var t=e=u.isObject(e)?e:{},n=t.keepCameraOn,r=t.videoElement,i=t.webcamVideoElement,o=e.cameraStream||{},a=o.getTracks&&o.getTracks()||[],s=!!a.length,c=a[0];!n&&s&&u.isFunction(c.stop)&&c.stop(),u.isElement(r)&&!i&&(r.pause(),u.isFunction(u.URL.revokeObjectURL)&&!u.webWorkerError&&r.src&&u.URL.revokeObjectURL(r.src),u.removeElement(r))}};function E(e){e=u.isObject(e)?e:{},C.stopVideoStreaming(e)}function T(e,t){var n=e.options||{},r=n.images,o=n.video,a=Number(n.gifWidth),s=Number(n.gifHeight),c=(Number(n.numFrames),e.cameraStream),l=e.videoElement,d=e.videoWidth,f=e.videoHeight,h=k.getCropDimensions({videoWidth:d,videoHeight:f,gifHeight:s,gifWidth:a}),m=t;n.crop=h,n.videoElement=l,n.videoWidth=d,n.videoHeight=f,n.cameraStream=c,u.isElement(l)&&(l.width=a+h.width,l.height=s+h.height,n.webcamVideoElement||(u.setCSSAttr(l,{position:"fixed",opacity:"0"}),i.body.appendChild(l)),l.play(),k.getGIF(n,function(e){r&&r.length||o&&o.length||E(e),m(e)}))}function M(e,t){if(t=u.isFunction(e)?e:t,e=u.isObject(e)?e:{},u.isFunction(t)){var n=u.mergeOptions(m,e)||{},r=e.cameraStream,o=n.images,s=o?o.length:0,c=n.video,l=n.webcamVideoElement;n=u.mergeOptions(n,{gifWidth:Math.floor(n.gifWidth),gifHeight:Math.floor(n.gifHeight)}),s?function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=e.callback,n=e.images,r=e.options,o=e.imagesLength,s=d.validate({getUserMedia:!0,"window.URL":!0}),c=[],l=0,f=void 0,h=void 0;if(s.error)return t(s);function m(){u.each(c,function(e,t){t&&(t.text?h.addFrame(t.img,r,t.text):h.addFrame(t,r))}),function(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})}(h,t)}h=new x(r),u.each(n,function(e,n){var a=n;n.src&&(a=a.src),u.isElement(a)?(r.crossOrigin&&(a.crossOrigin=r.crossOrigin),c[e]=a,(l+=1)===o&&m()):u.isString(a)&&(f=new Image,r.crossOrigin&&(f.crossOrigin=r.crossOrigin),function(r){n.text&&(r.text=n.text),r.onerror=function(e){var n=void 0;if(0==--o)return(n={}).error="None of the requested images was capable of being retrieved",t(n)},r.onload=function(t){n.text?c[e]={img:r,text:r.text}:c[e]=r,(l+=1)===o&&m(),u.removeElement(r)},r.src=a}(f),u.setCSSAttr(f,{position:"fixed",opacity:"0"}),i.body.appendChild(f))})}({images:o,imagesLength:s,callback:t,options:n}):c?function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=e.callback,n=e.existingVideo,r=e.options,i=d.validate({getUserMedia:!0,"window.URL":!0}),o=void 0,s=void 0;if(i.error)return t(i);if(u.isElement(n)&&n.src){if(s=n.src,o=u.getExtension(s),!u.isSupported.videoCodecs[o])return t(d.messages.videoCodecs)}else u.isArray(n)&&u.each(n,function(e,t){if(o=t instanceof Blob?t.type.substr(t.type.lastIndexOf("/")+1,t.length):t.substr(t.lastIndexOf(".")+1,t.length),u.isSupported.videoCodecs[o])return n=t,!1});C.startStreaming({completed:function(e){e.options=r||{},T(e,t)},existingVideo:n,crossOrigin:r.crossOrigin,options:r})}({existingVideo:c,callback:t,options:n}):function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=e.callback,n=e.lastCameraStream,r=e.options,i=e.webcamVideoElement;if(!p())return t(d.validate());r.savedRenderingContexts.length?k.getGIF(r,function(e){t(e)}):C.startVideoStreaming(function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{};e.options=r||{},T(e,t)},{lastCameraStream:n,callback:t,webcamVideoElement:i,crossOrigin:r.crossOrigin})}({lastCameraStream:r,callback:t,webcamVideoElement:l,options:n})}}var _={utils:l,error:f,defaultOptions:g,createGIF:M,takeSnapShot:function(e,t){if(t=u.isFunction(e)?e:t,e=u.isObject(e)?e:{},u.isFunction(t)){var n=u.mergeOptions(m,e);M(u.mergeOptions(n,{interval:.1,numFrames:1,gifWidth:Math.floor(n.gifWidth),gifHeight:Math.floor(n.gifHeight)}),t)}},stopVideoStreaming:E,isSupported:function(){return d.isValid()},isWebCamGIFSupported:p,isExistingVideoGIFSupported:function(e){var t=!1;if(u.isArray(e)&&e.length){if(u.each(e,function(e,n){u.isSupported.videoCodecs[n]&&(t=!0)}),!t)return!1}else if(u.isString(e)&&e.length&&!u.isSupported.videoCodecs[e])return!1;return d.isValid({getUserMedia:!0})},isExistingImagesGIFSupported:function(){return d.isValid({getUserMedia:!0})},VERSION:"0.4.5"};(r=function(){return _}.apply(t,[]))===a||(e.exports=r)}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{})},function(e,t){var n={getUrlParams:function(e){if(!e.match(/:\/\//)||!e.match(/\?/))return{};var t=e.split("?")[1];return t?JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(e,t){return""===e?t:decodeURIComponent(t)}):{}},getUrlParam:function(e,t){return this.getUrlParams(e)[t]},addUrlParams:function(e){var t=this.getUrlParams(location.href);for(var n in e)t[n]=encodeURIComponent(e[n]);var r="";for(var i in t)r+=r?"&":"?",r+=i+"="+t[i];var o=location.pathname+r;history.pushState(null,null,o)}};e.exports=n},function(e,t){var n={HTTPrequest:function(e,t,n,r){return new Promise(function(i,o){var a=new XMLHttpRequest;if(a.open(t,e),n)for(var s in n)a.setRequestHeader(s,n[s]);a.onload=function(){i(a.response)},a.onerror=function(e){o(Error("Network Error "+e))},r?a.send(r):a.send()})}};e.exports=n},function(e,t){var n,r,i,o=(n={done:[],undone:[]},{installUnRedo:function(e,t){document.getElementById(e).addEventListener("click",r,!1),document.getElementById(t).addEventListener("click",i,!1)},undo:r=function(){if(n.done.length>0){var e=n.done.pop();e.undo(),n.undone.unshift(e)}},redo:i=function(){if(n.undone.length>0){var e=n.undone.shift();e.do(),n.done.push(e)}},do:function(e){e.do(),n.done.push(e),n.undone.length=0,n.done.length>50&&n.done.shift()}});e.exports=o},function(e,t){e.exports=function(e,t,n,r,i,o,a){var s={start:r,last:null,beat:i||2e3,lifetime:n||500,color:e||"black",multiPeriod:isNaN(o)?"auto":parseFloat(o),strokeWidth:t||2,times:[]},c=[],u=new a.Path({visible:!1}),l=function(e){if(s.multiPeriod>0)return i;if(null!==s.last&&"auto"==s.multiPeriod){var t=Math.abs(s.last)+s.lifetime,n=Math.ceil(t/i);return Math.max(1,n)*i}return null!==s.last&&0===s.multiPeriod?Math.abs(s.last)+s.lifetime+1:e+1},d=function(e){var t=e-s.start,n=l(t),r=t%n;return{now:r=r<0?n+r:r,duration:n}};return{calculateTime:d,calculateDuration:l,getMultiPeriod:function(){return s.multiPeriod},segmentsToShow:function(e){return u.segments.filter(function(t,n){var r=s.times[n];return r<=e&&e<r+s.lifetime})},periodSegmentsToShow:function(e){var t=1,n=s.times,r=d(e),i=n.length>0?Math.min(n[n.length-1],n[0]):0,o=0;if((s.multiPeriod>0||null!==s.last)&&(o=Math.floor(i/r.duration)),s.multiPeriod>0&&n.length>0){var a=Math.max(n[n.length-1],n[0])+s.lifetime;t=Math.floor(a/r.duration)-o+1}for(var c=[],u=0;u<t;u++){var l=(o+u)*r.duration||0,f=this.segmentsToShow(r.now+l);c.push(f)}return c},redraw:function(e){this.periodSegmentsToShow(e).forEach(function(e,t){c.length<t+1&&c.push(function(e){return new a.Path({strokeColor:e.color,strokeWidth:e.strokeWidth,strokeJoin:"round",strokeCap:"round"})}(s));var n=c[t];n.removeSegments(),n.addSegments(e),1===n.segments.length&&n.add(n.segments[0])})},pushSegment:function(e,t){var r=t-s.start;r<0&&(r-=n);var i={point:e};s.times.push(r),u.add(i);var o=u.segments.length-2;u.segments[Math.max(0,o)].smooth()},completeCreation:function(e){var t;t=(t=e-s.start)<0?t-s.lifetime:t,s.last=t,u.segments.length>1&&u.smooth({type:"catmull-rom"})},clear:function(){c.forEach(function(e){e.removeSegments()})},exportData:function(){var e=new Object(s);return e.segments=u.segments.map(function(e){return[e.point.x,e.point.y]}),e},importData:function(e){this.clear(),u.removeSegments(),u.addSegments(e.segments),u.segments.forEach(function(e){e.smooth()}),(s=e).start=s.start},getLastUpdateTime:function(){var e=s.times.length;return s.start+s.times[e-1]||0}}}},function(e,t){e.exports=function(){var e,t,n,r,i,o,a,s=function(){i=t=e=n=a=0,r=o=1},c=function(e){return e/r*o};return s(),{reset:s,getTime:function(n){var i=e+(n-t)*r/o;return t=n,e=i,i},hasBeatChanged:function(e){var t=i?Math.floor(e/i):0,r=t!=n;return n=t,r},tapTempo:function(e){return a?(o=c(e-a)/i,a=0,!1):(a=e,!0)},convertFromRealTime:function(e){return e/c(1)},getBeat:function(){return i},setBeat:function(e){i=e},getSpeed:function(e){return r},setSpeed:function(e){r=e}}}},function(e,t,n){var r=n(8),i=n(7),o=n(6),a=n(0),s=function(e){var t,n,c,u,l,d,f,h,m,g,p,v,b,w,y,x,S,k,C=r(),E=function(){var e={width:t.width||h.canvas.width/g.view.pixelRatio,height:t.height||h.canvas.height/g.view.pixelRatio,speed:C.getSpeed(),lineData:t.lines.map(function(e){return e.exportData()})};return p&&(e.backgroundColor=p.fillColor.toCSS()),e},T=function(){var e=t;M({width:v,height:b,lines:[]}),e.lines.forEach(function(e){e.clear()})},M=function(e){t=e,W()},_=function(e,n){var r=t;return{do:function(){!function(e,n){T(),t.width=e.width||1e3,t.height=e.height||600,W(n),e.hasOwnProperty("speed")&&C.setSpeed(e.speed),e.hasOwnProperty("backgroundColor")||(e.backgroundColor="#ffffff"),A(e.backgroundColor),e.lineData.forEach(function(e){var n=i(e.color,e.strokeWidth,e.lifetime,I(),e.beat,e.multiPeriod,g);n.importData(e),t.lines.push(n)})}(e,n)},undo:function(){T(),M(r)}}},L=function(e,r){var a;return n=i(c,u,l,e,C.getBeat(),r,g),o.do((a=n,{do:function(){t.lines.push(a)},undo:function(){t.lines.pop(),a.clear()}})),n},O=function(e,t,r){n.pushSegment([e,t],r)},P=function(e){n.completeCreation(e),n=null},I=function(){return C.getTime(Date.now())},F=function(e){var t={width:e.width||1e3,height:e.height||600},n=t.width/t.height;return e.ratio&&(n<e.ratio?t.height=t.width/e.ratio:t.width=t.height*e.ratio,console.log(e.width,e.height,t)),t},W=function(e){if(e){var n=F(e);v=n.width,b=n.height}var r=t.width/t.height,i=v/b<r?v:Math.floor(b*r),o=Math.floor(i/r),a=i/t.width;g.activate(),g.view.zoom=a;var s=new h.paper.Point(h.canvas.width/2/a/g.view.pixelRatio,h.canvas.height/2/a/g.view.pixelRatio);g.view.center=s,g.view.viewSize=new h.paper.Size(i,o),p&&A(p.fillColor)},A=function(e){if(g.activate(),e){var t=new g.Path.Rectangle(g.view.bounds);t.fillColor=e,p&&p.replaceWith(t),p=t}else p&&(p.remove(),p=null)},U=function(e){t.lines.forEach(function(t){t.redraw(e)}),g.view.draw()},j=function(){g.activate(),m=!1;var e=function(){var t=C.getTime(Date.now());U(t),C.hasBeatChanged(t)&&f&&f(t),m||requestAnimationFrame(e)};e()},R=function(){m=!0},D=function(e,t){return e*t/function(e,t){if(e<0&&(e=-e),t<0&&(t=-t),t>e){var n=e;e=t,t=n}for(;;){if(0===t)return e;if(0==(e%=t))return t;t%=e}}(e,t)},H=function(){return t.lines.map(function(e){return"auto"===e.getMultiPeriod()?1:e.calculateDuration()}).reduce(D)};return x=(w=e).beat,S=w.multiPeriod,k=F(w),h=w.graphics,function(e,r){(t={lines:[]}).width=r.width,t.height=r.height,v=r.width,b=r.height,C.reset(),n=c=u=l=null,d=e||1}(S,k),C.reset(),C.setBeat(x||2e3),(g=new h.paper.PaperScope).setup(h.canvas),w.readonly||((y=new g.Tool).minDistance=3,y.onMouseDown=function(e){L(I(),d),O(e.point.x,e.point.y,I())},y.onMouseDrag=function(e){O(e.point.x,e.point.y,I())},y.onMouseUp=function(){P(I())}),A(w.backgroundColor),W(k),g.view.draw(),{start:j,stop:R,exportData:E,now:I,newLine:L,drawPoint:O,completeLine:P,importData:function(e,t){o.do(_(e,t))},clear:function(){var e;o.do((e=t,{do:T,undo:function(){M(e)}}))},setLineColor:function(e){c=e},setStrokeWidth:function(e){u=e},setLifetime:function(e){l=e},setPeriods:function(e){d=e},scale:W,getTime:C.getTime.bind(C),setSpeed:C.setSpeed.bind(C),setBeat:C.setBeat.bind(C),tapTempo:function(){return C.tapTempo(I())},setBeatListener:function(e){f=e},redrawAllLines:U,makeGifRecorder:function(){return a.makeGifRecorder(h.canvas)},findShortestLoop:H,record:function(e){var t=e.progress,n=e.duration||Math.min(6e3,H()),r=e.fullSize,i=e.graphics,o=(r?h.canvas.width:500)/g.view.pixelRatio,a=o/h.canvas.width*h.canvas.height,c=C.getTime(Date.now()),u=C.convertFromRealTime(50);i||(i={canvas:document.getElementById("hidden-canvas"),paper:h.paper});var l={graphics:i,width:o,height:a};p&&(l.backgroundColor=p.fillColor);var d=s(l),f=d.makeGifRecorder();d.importData(E()),R();for(var m=0;m<n;m+=u)d.redrawAllLines(c+m),f.recordImage();return f.makeGif(50,t,r).then(function(e){return j(),e})},makeCircleLineData:function(e,t,n,r){var i=t.x+n.width/2,o=t.y+n.height/2,a=n.width/2,s=2*Math.PI*a/2,c=20*r,u={start:e.start||0,last:e.last||e.beat,beat:e.beat,lifetime:e.lifetime,color:"#000000",multiPeriod:1,strokeWidth:e.strokeWidth};r=r||.05,u.times=[],u.segments=[];for(var l=0;l<s;l+=c){var d=l/a-Math.PI/2;u.segments.push([i+Math.sin(d)*a,o-Math.cos(d)*a]),u.times.push(l/r)}return u},makeSinLineData:function(e,t,n,r){r=r||.05;for(var i=n.width,o=n.height,a=t.x,s=t.y,c=4*Math.sqrt(Math.pow(o,2)+Math.pow(i/4,2)),u=20*r,l={start:e.start||0,last:e.last||e.beat,beat:e.beat,lifetime:e.lifetime,color:"#000000",multiPeriod:1,strokeWidth:e.strokeWidth,times:[],segments:[]},d=0;d<c;d+=u){var f=d/c*Math.PI*4;l.segments.push([a+d/c*i,s+(Math.cos(f-Math.PI)+1)/2*o/2]),l.times.push(d/r)}return l},makeStraightLineData:function(e,t,n,r){var i=n.width,o=n.height,a=Math.sqrt(Math.pow(i,2)+Math.pow(o,2)),s=i/a,c=o/a,u=20*r,l={start:e.start||0,last:e.last||e.beat,beat:e.beat,lifetime:e.lifetime,color:"#000000",multiPeriod:1,strokeWidth:e.strokeWidth};r=r||.025,l.times=[],l.segments=[];for(var d=0;d<a;d+=u)l.segments.push([t.x+d*s,t.y+d*c]),l.times.push(d/r);return l},makeTimingDemo:function(e,t,n){var r=n.width/t[0].length,i=n.height/t.length,o=50,a=(i-50)/2,c={width:r-2*o,height:i-2*a},u={width:n.width,height:n.height,backgroundColor:!1,lineData:[]},l=s({graphics:{canvas:e,paper:h.paper},backgroundColor:!1,width:u.width,height:u.height});return t.forEach(function(e,t){e.forEach(function(e,n){var s=Math.round(n*r)+o,d=Math.round(t*i)+a,f={beat:e.beat,lifetime:e.lifetime,strokeWidth:7},h={x:s,y:d+c.height/2},m=l.makeStraightLineData(f,{x:h.x,y:h.y},{width:c.width,height:0},.05);u.lineData.push(m)})}),l.importData(u),l.start(),l},getLastUpdateTime:function(){var e=t.lines.length;return e?t.lines[e-1].getLastUpdateTime():0},_ps:g}};e.exports=s},function(e,t,n){var r=n(9),i=n(2),o=function(e){var t=e.firstElementChild;if(t){var n=t.cloneNode(!1);t.parentNode.replaceChild(n,t)}else t=document.createElement("table"),e.appendChild(t);return e.firstElementChild};document.addEventListener("DOMContentLoaded",function(){try{!function(e){var t={canvas:document.getElementById("main-canvas"),paper:paper},n=r({graphics:t,width:window.innerWidth,readonly:!0,height:window.innerHeight*(1-(.75-1/1.42))}),a=i(n,e);if(a.next(),window.g=a,window.addEventListener("resize",function(){n.scale({width:window.innerWidth,height:window.innerHeight*(1-(.75-1/1.42))})}),n.start(),document.addEventListener("keypress",function(e){"37"==e.keyCode?a.next(-1):"39"==e.keyCode&&a.next(1)}),document.addEventListener("keypress",function(e){var t=String.fromCharCode(e.charCode);"p"===t?a.togglePlay&&a.togglePlay():"s"===t&&a.save&&a.save()}),e.navigation){document.getElementById("navigation").classList.remove("hidden"),document.getElementById("bt-previous").addEventListener("click",function(){a.next(-1)});var s=document.getElementById("bt-save");e.save?s.addEventListener("click",function(){a.save(!0)}):s.classList.add("hidden"),document.getElementById("bt-next").addEventListener("click",function(){a.next(1)});var c=document.getElementById("menu");c.addEventListener("click",function(){c.classList.add("hidden")}),document.getElementById("bt-menu").addEventListener("click",function(){a.getList().then(function(e){var t=o(c.firstElementChild);console.log(t),e.forEach(function(e,n){n%3==0&&t.appendChild(document.createElement("tr"));var r=t.lastElementChild.appendChild(document.createElement("td")),i='<div class="title">';i+=`${e.fullTitle||e.title}</div>`,i+=`<div>${e.author}</div>`,r.insertAdjacentHTML("beforeend",i),r.addEventListener("click",function(){a.load(e).then(function(){c.classList.add("hidden")})})})}).catch(function(e){console.error(e)}),c.classList.remove("hidden")}),document.getElementById("bt-bouboucle").addEventListener("click",function(){location.href="/index.html"})}}(config)}catch(e){console.error(e)}})}]);